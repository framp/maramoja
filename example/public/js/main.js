/*! maramoja-example 12-05-2013 */
function getGlobal(){return function(){return this.dust}.call(null)}var dust={};(function(dust){function Context(t,e,r){this.stack=t,this.global=e,this.blocks=r}function Stack(t,e,r,n){this.tail=e,this.isObject=!dust.isArray(t)&&t&&"object"==typeof t,this.head=t,this.index=r,this.of=n}function Stub(t){this.head=new Chunk(this),this.callback=t,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(t,e,r){this.root=t,this.next=e,this.data=[],this.flushable=!1,this.taps=r}function Tap(t,e){this.head=t,this.tail=e}dust.helpers={},dust.cache={},dust.register=function(t,e){t&&(dust.cache[t]=e)},dust.render=function(t,e,r){var n=new Stub(r).head;dust.load(t,n,Context.wrap(e)).end()},dust.stream=function(t,e){var r=new Stream;return dust.nextTick(function(){dust.load(t,r.head,Context.wrap(e)).end()}),r},dust.renderSource=function(t,e,r){return dust.compileFn(t)(e,r)},dust.compileFn=function(t,e){var r=dust.loadSource(dust.compile(t,e));return function(t,e){var n=e?new Stub(e):new Stream;return dust.nextTick(function(){r(n.head,Context.wrap(t)).end()}),n}},dust.load=function(t,e,r){var n=dust.cache[t];return n?n(e,r):dust.onLoad?e.map(function(e){dust.onLoad(t,function(n,a){return n?e.setError(n):(dust.cache[t]||dust.loadSource(dust.compile(a,t)),dust.cache[t](e,r).end(),void 0)})}):e.setError(Error("Template Not Found: "+t))},dust.loadSource=function(source,path){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)},dust.nextTick=function(){return"undefined"!=typeof process?process.nextTick:function(t){setTimeout(t,0)}}(),dust.isEmpty=function(t){return dust.isArray(t)&&!t.length?!0:0===t?!1:!t},dust.filter=function(t,e,r){if(r)for(var n=0,a=r.length;a>n;n++){var o=r[n];"s"===o?e=null:"function"==typeof dust.filters[o]&&(t=dust.filters[o](t))}return e&&(t=dust.filters[e](t)),t},dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return JSON?JSON.stringify(t):t},jp:function(t){return JSON?JSON.parse(t):t}},dust.makeBase=function(t){return new Context(new Stack,t)},Context.wrap=function(t){return t instanceof Context?t:new Context(new Stack(t))},Context.prototype.get=function(t){for(var e,r=this.stack;r;){if(r.isObject&&(e=r.head[t],void 0!==e))return e;r=r.tail}return this.global?this.global[t]:void 0},Context.prototype.getPath=function(t,e){var r=this.stack,n=e.length;if(t&&0===n)return r.head;r=r.head;for(var a=0;r&&n>a;)r=r[e[a]],a++;return r},Context.prototype.push=function(t,e,r){return new Context(new Stack(t,this.stack,e,r),this.global,this.blocks)},Context.prototype.rebase=function(t){return new Context(new Stack(t),this.global,this.blocks)},Context.prototype.current=function(){return this.stack.head},Context.prototype.getBlock=function(t,e,r){"function"==typeof t&&(t=t(e,r).data.join(""),e.data=[]);var n=this.blocks;if(n)for(var a,o=n.length;o--;)if(a=n[o][t])return a},Context.prototype.shiftBlocks=function(t){var e,r=this.blocks;return t?(e=r?r.concat([t]):[t],new Context(this.stack,this.global,e)):this},Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.callback(t.error),this.flush=function(){},void 0):void 0;this.out+=t.data.join(""),t=t.next,this.head=t}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.emit("error",t.error),this.flush=function(){},void 0):void 0;this.emit("data",t.data.join("")),t=t.next,this.head=t}this.emit("end")},Stream.prototype.emit=function(t,e){if(!this.events)return!1;var r=this.events[t];if(!r)return!1;if("function"==typeof r)r(e);else for(var n=r.slice(0),a=0,o=n.length;o>a;a++)n[a](e)},Stream.prototype.on=function(t,e){return this.events||(this.events={}),this.events[t]?"function"==typeof this.events[t]?this.events[t]=[this.events[t],e]:this.events[t].push(e):this.events[t]=e,this},Stream.prototype.pipe=function(t){return this.on("data",function(e){t.write(e,"utf8")}).on("end",function(){t.end()}).on("error",function(e){t.error(e)}),this},Chunk.prototype.write=function(t){var e=this.taps;return e&&(t=e.go(t)),this.data.push(t),this},Chunk.prototype.end=function(t){return t&&this.write(t),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),r=new Chunk(this.root,e,this.taps);return this.next=r,this.flushable=!0,t(r),e},Chunk.prototype.tap=function(t){var e=this.taps;return this.taps=e?e.push(t):new Tap(t),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(t,e){return t(this,e)},Chunk.prototype.reference=function(t,e,r,n){return"function"==typeof t&&(t.isFunction=!0,t=t.apply(e.current(),[this,e,null,{auto:r,filters:n}]),t instanceof Chunk)?t:dust.isEmpty(t)?this:this.write(dust.filter(t,r,n))},Chunk.prototype.section=function(t,e,r,n){if("function"==typeof t&&(t=t.apply(e.current(),[this,e,r,n]),t instanceof Chunk))return t;var a=r.block,o=r["else"];if(n&&(e=e.push(n)),dust.isArray(t)){if(a){var s=t.length,i=this;if(s>0){e.stack.head&&(e.stack.head.$len=s);for(var u=0;s>u;u++)e.stack.head&&(e.stack.head.$idx=u),i=a(i,e.push(t[u],u,s));return e.stack.head&&(e.stack.head.$idx=void 0,e.stack.head.$len=void 0),i}if(o)return o(this,e)}}else if(t===!0){if(a)return a(this,e)}else if(t||0===t){if(a)return a(this,e.push(t))}else if(o)return o(this,e);return this},Chunk.prototype.exists=function(t,e,r){var n=r.block,a=r["else"];if(dust.isEmpty(t)){if(a)return a(this,e)}else if(n)return n(this,e);return this},Chunk.prototype.notexists=function(t,e,r){var n=r.block,a=r["else"];if(dust.isEmpty(t)){if(n)return n(this,e)}else if(a)return a(this,e);return this},Chunk.prototype.block=function(t,e,r){var n=r.block;return t&&(n=t),n?n(this,e):this},Chunk.prototype.partial=function(t,e,r){var n;return r?(n=dust.makeBase(e.global),n.blocks=e.blocks,e.stack&&e.stack.tail&&(n.stack=e.stack.tail),n=n.push(r),n=n.push(e.stack.head)):n=e,"function"==typeof t?this.capture(t,n,function(t,e){dust.load(t,e,n).end()}):dust.load(t,this,n)},Chunk.prototype.helper=function(t,e,r,n){return dust.helpers[t]?dust.helpers[t](this,e,r,n):this},Chunk.prototype.capture=function(t,e,r){return this.map(function(n){var a=new Stub(function(t,e){t?n.setError(t):r(e,n)});t(a.head,e).end()})},Chunk.prototype.setError=function(t){return this.error=t,this.root.flush(),this},Tap.prototype.push=function(t){return new Tap(t,this)},Tap.prototype.go=function(t){for(var e=this;e;)t=e.head(t),e=e.tail;return t};var HCHARS=RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){return"string"==typeof t?HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t:t};var BS=/\\/g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t}})(dust),"undefined"!=typeof exports&&("undefined"!=typeof process&&require("./server")(dust),module.exports=dust),window.JSON||(window.JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var r,n,a,o,s,i=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?u+"":"null";case"boolean":case"null":return u+"";case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,r=0;o>r;r+=1)s[r]=str(r,u)||"null";return a=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+i+"]":"["+s.join(",")+"]",gap=i,a}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;o>r;r+=1)n=rep[r],"string"==typeof n&&(a=str(n,u),a&&s.push(quote(n)+(gap?": ":":")+a));else for(n in u)Object.hasOwnProperty.call(u,n)&&(a=str(n,u),a&&s.push(quote(n)+(gap?": ":":")+a));return a=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+i+"}":"{"+s.join(",")+"}",gap=i,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var r,n,a=t[e];if(a&&"object"==typeof a)for(r in a)Object.hasOwnProperty.call(a,r)&&(n=walk(a,r),void 0!==n?a[r]=n:delete a[r]);return reviver.call(t,e,a)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(t,e){"use strict";var r=t.History=t.History||{};if(r.Adapter!==e)throw Error("History.js Adapter has already been loaded...");r.Adapter={handlers:{},_uid:1,uid:function(t){return t._uid||(t._uid=r.Adapter._uid++)},bind:function(t,e,n){var a=r.Adapter.uid(t);r.Adapter.handlers[a]=r.Adapter.handlers[a]||{},r.Adapter.handlers[a][e]=r.Adapter.handlers[a][e]||[],r.Adapter.handlers[a][e].push(n),t["on"+e]=function(t,e){return function(n){r.Adapter.trigger(t,e,n)}}(t,e)},trigger:function(t,e,n){n=n||{};var a,o,s=r.Adapter.uid(t);for(r.Adapter.handlers[s]=r.Adapter.handlers[s]||{},r.Adapter.handlers[s][e]=r.Adapter.handlers[s][e]||[],a=0,o=r.Adapter.handlers[s][e].length;o>a;++a)r.Adapter.handlers[s][e][a].apply(this,[n])},extractEventData:function(t,r){var n=r&&r[t]||e;return n},onDomLoad:function(e){var r=t.setTimeout(function(){e()},2e3);t.onload=function(){clearTimeout(r),e()}}},r.init!==e&&r.init()}(window),function(t){"use strict";var e=t.document,r=t.setTimeout||r,n=t.clearTimeout||n,a=t.setInterval||a,o=t.History=t.History||{};if(o.initHtml4!==undefined)throw Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){return o.initHtml4.initialized!==undefined?!1:(o.initHtml4.initialized=!0,o.enabled=!0,o.savedHashes=[],o.isLastHash=function(t){var e,r=o.getHashByIndex();return e=t===r},o.saveHash=function(t){return o.isLastHash(t)?!1:(o.savedHashes.push(t),!0)},o.getHashByIndex=function(t){var e=null;return e=t===undefined?o.savedHashes[o.savedHashes.length-1]:0>t?o.savedHashes[o.savedHashes.length+t]:o.savedHashes[t]},o.discardedHashes={},o.discardedStates={},o.discardState=function(t,e,r){var n,a=o.getHashByState(t);return n={discardedState:t,backState:r,forwardState:e},o.discardedStates[a]=n,!0},o.discardHash=function(t,e,r){var n={discardedHash:t,backState:r,forwardState:e};return o.discardedHashes[t]=n,!0},o.discardedState=function(t){var e,r=o.getHashByState(t);return e=o.discardedStates[r]||!1},o.discardedHash=function(t){var e=o.discardedHashes[t]||!1;return e},o.recycleState=function(t){var e=o.getHashByState(t);return o.discardedState(t)&&delete o.discardedStates[e],!0},o.emulated.hashChange&&(o.hashChangeInit=function(){o.checkerFunction=null;var r,n,s,i,u="";return o.isInternetExplorer()?(r="historyjs-iframe",n=e.createElement("iframe"),n.setAttribute("id",r),n.style.display="none",e.body.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.close(),s="",i=!1,o.checkerFunction=function(){if(i)return!1;i=!0;var e=o.getHash()||"",r=o.unescapeHash(n.contentWindow.document.location.hash)||"";return e!==u?(u=e,r!==e&&(s=r=e,n.contentWindow.document.open(),n.contentWindow.document.close(),n.contentWindow.document.location.hash=o.escapeHash(e)),o.Adapter.trigger(t,"hashchange")):r!==s&&(s=r,o.setHash(r,!1)),i=!1,!0}):o.checkerFunction=function(){var e=o.getHash();return e!==u&&(u=e,o.Adapter.trigger(t,"hashchange")),!0},o.intervalList.push(a(o.checkerFunction,o.options.hashChangeInterval)),!0},o.Adapter.onDomLoad(o.hashChangeInit)),o.emulated.pushState&&(o.onHashChange=function(r){var n,a=r&&r.newURL||e.location.href,s=o.getHashByUrl(a),i=null,u=null;return o.isLastHash(s)?(o.busy(!1),!1):(o.doubleCheckComplete(),o.saveHash(s),s&&o.isTraditionalAnchor(s)?(o.Adapter.trigger(t,"anchorchange"),o.busy(!1),!1):(i=o.extractState(o.getFullUrl(s||e.location.href,!1),!0),o.isLastSavedState(i)?(o.busy(!1),!1):(u=o.getHashByState(i),(n=o.discardedState(i))?(o.getHashByIndex(-2)===o.getHashByState(n.forwardState)?o.back(!1):o.forward(!1),!1):(o.pushState(i.data,i.title,i.url,!1),!0))))},o.Adapter.bind(t,"hashchange",o.onHashChange),o.pushState=function(r,n,a,s){if(o.getHashByUrl(a))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s}),!1;o.busy(!0);var i=o.createStateObject(r,n,a),u=o.getHashByState(i),l=o.getState(!1),c=o.getHashByState(l),d=o.getHash();return o.storeState(i),o.expectedStateId=i.id,o.recycleState(i),o.setTitle(i),u===c?(o.busy(!1),!1):u!==d&&u!==o.getShortUrl(e.location.href)?(o.setHash(u,!1),!1):(o.saveState(i),o.Adapter.trigger(t,"statechange"),o.busy(!1),!0)},o.replaceState=function(t,e,r,n){if(o.getHashByUrl(r))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(n!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:n}),!1;o.busy(!0);var a=o.createStateObject(t,e,r),s=o.getState(!1),i=o.getStateByIndex(-2);return o.discardState(s,a,i),o.pushState(a.data,a.title,a.url,!1),!0}),o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(t,"hashchange")}),undefined)},o.init!==undefined&&o.init()}(window),function(t,e){"use strict";var r=t.console||e,n=t.document,a=t.navigator,o=t.sessionStorage||!1,s=t.setTimeout,i=t.clearTimeout,u=t.setInterval,l=t.clearInterval,c=t.JSON,d=t.alert,h=t.History=t.History||{},p=t.history;if(c.stringify=c.stringify||c.encode,c.parse=c.parse||c.decode,h.init!==e)throw Error("History.js Core has already been loaded...");h.init=function(){return h.Adapter===e?!1:(h.initCore!==e&&h.initCore(),h.initHtml4!==e&&h.initHtml4(),!0)},h.initCore=function(){if(h.initCore.initialized!==e)return!1;if(h.initCore.initialized=!0,h.options=h.options||{},h.options.hashChangeInterval=h.options.hashChangeInterval||100,h.options.safariPollInterval=h.options.safariPollInterval||500,h.options.doubleCheckInterval=h.options.doubleCheckInterval||500,h.options.storeInterval=h.options.storeInterval||1e3,h.options.busyDelay=h.options.busyDelay||250,h.options.debug=h.options.debug||!1,h.options.initialTitle=h.options.initialTitle||n.title,h.intervalList=[],h.clearAllIntervals=function(){var t,r=h.intervalList;if(r!==e&&null!==r){for(t=0;r.length>t;t++)l(r[t]);h.intervalList=null}},h.debug=function(){h.options.debug&&h.log.apply(h,arguments)},h.log=function(){var t,a,o,s,i,u=!(r===e||r.log===e||r.log.apply===e),l=n.getElementById("log");for(u?(s=Array.prototype.slice.call(arguments),t=s.shift(),r.debug!==e?r.debug.apply(r,[t,s]):r.log.apply(r,[t,s])):t="\n"+arguments[0]+"\n",a=1,o=arguments.length;o>a;++a){if(i=arguments[a],"object"==typeof i&&c!==e)try{i=c.stringify(i)}catch(h){}t+="\n"+i+"\n"}return l?(l.value+=t+"\n-----\n",l.scrollTop=l.scrollHeight-l.clientHeight):u||d(t),!0},h.getInternetExplorerMajorVersion=function(){var t=h.getInternetExplorerMajorVersion.cached=h.getInternetExplorerMajorVersion.cached!==e?h.getInternetExplorerMajorVersion.cached:function(){for(var t=3,e=n.createElement("div"),r=e.getElementsByTagName("i");(e.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->")&&r[0];);return t>4?t:!1}();return t},h.isInternetExplorer=function(){var t=h.isInternetExplorer.cached=h.isInternetExplorer.cached!==e?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return t},h.emulated={pushState:!Boolean(t.history&&t.history.pushState&&t.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(a.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(a.userAgent))),hashChange:Boolean(!("onhashchange"in t||"onhashchange"in n)||h.isInternetExplorer()&&8>h.getInternetExplorerMajorVersion())},h.enabled=!h.emulated.pushState,h.bugs={setHash:Boolean(!h.emulated.pushState&&"Apple Computer, Inc."===a.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(a.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&"Apple Computer, Inc."===a.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(a.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&8>h.getInternetExplorerMajorVersion()),hashEscape:Boolean(h.isInternetExplorer()&&7>h.getInternetExplorerMajorVersion())},h.isEmptyObject=function(t){for(var e in t)return!1;return!0},h.cloneObject=function(t){var e,r;return t?(e=c.stringify(t),r=c.parse(e)):r={},r},h.getRootUrl=function(){var t=n.location.protocol+"//"+(n.location.hostname||n.location.host);return n.location.port&&(t+=":"+n.location.port),t+="/"},h.getBaseHref=function(){var t=n.getElementsByTagName("base"),e=null,r="";return 1===t.length&&(e=t[0],r=e.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r},h.getBaseUrl=function(){var t=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return t},h.getPageUrl=function(){var t,e=h.getState(!1,!1),r=(e||{}).url||n.location.href;return t=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(t){return/\./.test(t)?t:t+"/"})},h.getBasePageUrl=function(){var t=n.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(t){return/[^\/]$/.test(t)?"":t}).replace(/\/+$/,"")+"/";return t},h.getFullUrl=function(t,r){var n=t,a=t.substring(0,1);return r=r===e?!0:r,/[a-z]+\:\/\//.test(t)||(n="/"===a?h.getRootUrl()+t.replace(/^\/+/,""):"#"===a?h.getPageUrl().replace(/#.*/,"")+t:"?"===a?h.getPageUrl().replace(/[\?#].*/,"")+t:r?h.getBaseUrl()+t.replace(/^(\.\/)+/,""):h.getBasePageUrl()+t.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},h.getShortUrl=function(t){var e=t,r=h.getBaseUrl(),n=h.getRootUrl();return h.emulated.pushState&&(e=e.replace(r,"")),e=e.replace(n,"/"),h.isTraditionalAnchor(e)&&(e="./"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},h.store={},h.idToState=h.idToState||{},h.stateToId=h.stateToId||{},h.urlToId=h.urlToId||{},h.storedStates=h.storedStates||[],h.savedStates=h.savedStates||[],h.normalizeStore=function(){h.store.idToState=h.store.idToState||{},h.store.urlToId=h.store.urlToId||{},h.store.stateToId=h.store.stateToId||{}},h.getState=function(t,r){t===e&&(t=!0),r===e&&(r=!0);var n=h.getLastSavedState();return!n&&r&&(n=h.createStateObject()),t&&(n=h.cloneObject(n),n.url=n.cleanUrl||n.url),n},h.getIdByState=function(t){var r,n=h.extractId(t.url);if(!n)if(r=h.getStateString(t),h.stateToId[r]!==e)n=h.stateToId[r];else if(h.store.stateToId[r]!==e)n=h.store.stateToId[r];else{for(;;)if(n=(new Date).getTime()+(Math.random()+"").replace(/\D/g,""),h.idToState[n]===e&&h.store.idToState[n]===e)break;h.stateToId[r]=n,h.idToState[n]=t}return n},h.normalizeState=function(t){var r,a;return t&&"object"==typeof t||(t={}),t.normalized!==e?t:(t.data&&"object"==typeof t.data||(t.data={}),r={},r.normalized=!0,r.title=t.title||"",r.url=h.getFullUrl(h.unescapeString(t.url||n.location.href)),r.hash=h.getShortUrl(r.url),r.data=h.cloneObject(t.data),r.id=h.getIdByState(r),r.cleanUrl=r.url.replace(/\??\&_suid.*/,""),r.url=r.cleanUrl,a=!h.isEmptyObject(r.data),(r.title||a)&&(r.hash=h.getShortUrl(r.url).replace(/\??\&_suid.*/,""),/\?/.test(r.hash)||(r.hash+="?"),r.hash+="&_suid="+r.id),r.hashedUrl=h.getFullUrl(r.hash),(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(r)&&(r.url=r.hashedUrl),r)},h.createStateObject=function(t,e,r){var n={data:t,title:e,url:r};return n=h.normalizeState(n)},h.getStateById=function(t){t+="";var r=h.idToState[t]||h.store.idToState[t]||e;return r},h.getStateString=function(t){var e,r,n;return e=h.normalizeState(t),r={data:e.data,title:t.title,url:t.url},n=c.stringify(r)},h.getStateId=function(t){var e,r;return e=h.normalizeState(t),r=e.id},h.getHashByState=function(t){var e,r;return e=h.normalizeState(t),r=e.hash},h.extractId=function(t){var e,r,n;return r=/(.*)\&_suid=([0-9]+)$/.exec(t),n=r?r[1]||t:t,e=r?(r[2]||"")+"":"",e||!1},h.isTraditionalAnchor=function(t){var e=!/[\/\?\.]/.test(t);return e},h.extractState=function(t,e){var r,n,a=null;return e=e||!1,r=h.extractId(t),r&&(a=h.getStateById(r)),a||(n=h.getFullUrl(t),r=h.getIdByUrl(n)||!1,r&&(a=h.getStateById(r)),a||!e||h.isTraditionalAnchor(t)||(a=h.createStateObject(null,null,n))),a},h.getIdByUrl=function(t){var r=h.urlToId[t]||h.store.urlToId[t]||e;return r},h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||e},h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||e},h.hasUrlDuplicate=function(t){var e,r=!1;return e=h.extractState(t.url),r=e&&e.id!==t.id},h.storeState=function(t){return h.urlToId[t.url]=t.id,h.storedStates.push(h.cloneObject(t)),t},h.isLastSavedState=function(t){var e,r,n,a=!1;return h.savedStates.length&&(e=t.id,r=h.getLastSavedState(),n=r.id,a=e===n),a},h.saveState=function(t){return h.isLastSavedState(t)?!1:(h.savedStates.push(h.cloneObject(t)),!0)},h.getStateByIndex=function(t){var r=null;return r=t===e?h.savedStates[h.savedStates.length-1]:0>t?h.savedStates[h.savedStates.length+t]:h.savedStates[t]},h.getHash=function(){var t=h.unescapeHash(n.location.hash);return t},h.unescapeString=function(e){for(var r,n=e;;){if(r=t.unescape(n),r===n)break;n=r}return n},h.unescapeHash=function(t){var e=h.normalizeHash(t);return e=h.unescapeString(e)},h.normalizeHash=function(t){var e=t.replace(/[^#]*#/,"").replace(/#.*/,"");return e},h.setHash=function(t,e){var r,a,o;return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:e}),!1):(r=h.escapeHash(t),h.busy(!0),a=h.extractState(t,!0),a&&!h.emulated.pushState?h.pushState(a.data,a.title,a.url,!1):n.location.hash!==r&&(h.bugs.setHash?(o=h.getPageUrl(),h.pushState(null,null,o+"#"+r,!1)):n.location.hash=r),h)},h.escapeHash=function(e){var r=h.normalizeHash(e);return r=t.escape(r),h.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r},h.getHashByUrl=function(t){var e=(t+"").replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return e=h.unescapeHash(e)},h.setTitle=function(t){var e,r=t.title;r||(e=h.getStateByIndex(0),e&&e.url===t.url&&(r=e.title||h.options.initialTitle));try{n.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(a){}return n.title=r,h},h.queues=[],h.busy=function(t){if(t!==e?h.busy.flag=t:h.busy.flag===e&&(h.busy.flag=!1),!h.busy.flag){i(h.busy.timeout);var r=function(){var t,e,n;if(!h.busy.flag)for(t=h.queues.length-1;t>=0;--t)e=h.queues[t],0!==e.length&&(n=e.shift(),h.fireQueueItem(n),h.busy.timeout=s(r,h.options.busyDelay))};h.busy.timeout=s(r,h.options.busyDelay)}return h.busy.flag},h.busy.flag=!1,h.fireQueueItem=function(t){return t.callback.apply(t.scope||h,t.args||[])},h.pushQueue=function(t){return h.queues[t.queue||0]=h.queues[t.queue||0]||[],h.queues[t.queue||0].push(t),h},h.queue=function(t,r){return"function"==typeof t&&(t={callback:t}),r!==e&&(t.queue=r),h.busy()?h.pushQueue(t):h.fireQueueItem(t),h},h.clearQueue=function(){return h.busy.flag=!1,h.queues=[],h},h.stateChanged=!1,h.doubleChecker=!1,h.doubleCheckComplete=function(){return h.stateChanged=!0,h.doubleCheckClear(),h},h.doubleCheckClear=function(){return h.doubleChecker&&(i(h.doubleChecker),h.doubleChecker=!1),h},h.doubleCheck=function(t){return h.stateChanged=!1,h.doubleCheckClear(),h.bugs.ieDoubleCheck&&(h.doubleChecker=s(function(){return h.doubleCheckClear(),h.stateChanged||t(),!0},h.options.doubleCheckInterval)),h},h.safariStatePoll=function(){var e,r=h.extractState(n.location.href);if(!h.isLastSavedState(r))return e=r,e||(e=h.createStateObject()),h.Adapter.trigger(t,"popstate"),h},h.back=function(t){return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.back,args:arguments,queue:t}),!1):(h.busy(!0),h.doubleCheck(function(){h.back(!1)}),p.go(-1),!0)},h.forward=function(t){return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:t}),!1):(h.busy(!0),h.doubleCheck(function(){h.forward(!1)}),p.go(1),!0)},h.go=function(t,e){var r;if(t>0)for(r=1;t>=r;++r)h.forward(e);else{if(!(0>t))throw Error("History.go: History.go requires a positive or negative integer passed.");for(r=-1;r>=t;--r)h.back(e)}return h},h.emulated.pushState){var f=function(){};h.pushState=h.pushState||f,h.replaceState=h.replaceState||f}else h.onPopState=function(e,r){var a,o,s=!1,i=!1;return h.doubleCheckComplete(),(a=h.getHash())?(o=h.extractState(a||n.location.href,!0),o?h.replaceState(o.data,o.title,o.url,!1):(h.Adapter.trigger(t,"anchorchange"),h.busy(!1)),h.expectedStateId=!1,!1):(s=h.Adapter.extractEventData("state",e,r)||!1,i=s?h.getStateById(s):h.expectedStateId?h.getStateById(h.expectedStateId):h.extractState(n.location.href),i||(i=h.createStateObject(null,null,n.location.href)),h.expectedStateId=!1,h.isLastSavedState(i)?(h.busy(!1),!1):(h.storeState(i),h.saveState(i),h.setTitle(i),h.Adapter.trigger(t,"statechange"),h.busy(!1),!0))},h.Adapter.bind(t,"popstate",h.onPopState),h.pushState=function(e,r,n,a){if(h.getHashByUrl(n)&&h.emulated.pushState)throw Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(a!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:a}),!1;h.busy(!0);var o=h.createStateObject(e,r,n);return h.isLastSavedState(o)?h.busy(!1):(h.storeState(o),h.expectedStateId=o.id,p.pushState(o.id,o.title,o.url),h.Adapter.trigger(t,"popstate")),!0},h.replaceState=function(e,r,n,a){if(h.getHashByUrl(n)&&h.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(a!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:a}),!1;h.busy(!0);var o=h.createStateObject(e,r,n);return h.isLastSavedState(o)?h.busy(!1):(h.storeState(o),h.expectedStateId=o.id,p.replaceState(o.id,o.title,o.url),h.Adapter.trigger(t,"popstate")),!0};if(o){try{h.store=c.parse(o.getItem("History.store"))||{}}catch(g){h.store={}}h.normalizeStore()}else h.store={},h.normalizeStore();h.Adapter.bind(t,"beforeunload",h.clearAllIntervals),h.Adapter.bind(t,"unload",h.clearAllIntervals),h.saveState(h.storeState(h.extractState(n.location.href,!0))),o&&(h.onUnload=function(){var t,e;try{t=c.parse(o.getItem("History.store"))||{}}catch(r){t={}}t.idToState=t.idToState||{},t.urlToId=t.urlToId||{},t.stateToId=t.stateToId||{};for(e in h.idToState)h.idToState.hasOwnProperty(e)&&(t.idToState[e]=h.idToState[e]);for(e in h.urlToId)h.urlToId.hasOwnProperty(e)&&(t.urlToId[e]=h.urlToId[e]);for(e in h.stateToId)h.stateToId.hasOwnProperty(e)&&(t.stateToId[e]=h.stateToId[e]);h.store=t,h.normalizeStore(),o.setItem("History.store",c.stringify(t))},h.intervalList.push(u(h.onUnload,h.options.storeInterval)),h.Adapter.bind(t,"beforeunload",h.onUnload),h.Adapter.bind(t,"unload",h.onUnload)),h.emulated.pushState||(h.bugs.safariPoll&&h.intervalList.push(u(h.safariStatePoll,h.options.safariPollInterval)),("Apple Computer, Inc."===a.vendor||"Mozilla"===(a.appCodeName||""))&&(h.Adapter.bind(t,"hashchange",function(){h.Adapter.trigger(t,"popstate")}),h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(t,"hashchange")})))},h.init()}(window),function(){function t(t,e){return e=e.shiftBlocks(r),t.partial("layout",e,null)}function e(t,e){return e=e.shiftBlocks(r),t.write("Hello ").reference(e.get("name"),e,"h")}dust.register("index",t);var r={main:e};return t}(),function(){function t(t,r){return t.exists(r.get("skipLayout"),r,{"else":e,block:n},null)}function e(t,e){return t.write("<html><head><title>").reference(e.get("title"),e,"h").write('</title><script src="http://code.jquery.com/jquery-1.9.1.min.js"></script><script src="/js/main.js"></script><link rel="stylesheet" type="text/css" href="/css/main.css" /></head><body>').block(e.getBlock("main"),e,{block:r},null).write("</body></html>")}function r(t){return t}function n(t,e){return t.block(e.getBlock("main"),e,{block:a},null)}function a(t){return t}return dust.register("layout",t),t}(),function(){function t(t,e){return e=e.shiftBlocks(r),t.partial("layout",e,null)}function e(t,e){return e=e.shiftBlocks(r),t.reference(e.get("song"),e,"h").write('<br /><a href="/songs">Back to songs</a>')}dust.register("song",t);var r={main:e};return t}(),function(){function t(t,e){return e=e.shiftBlocks(n),t.partial("layout",e,null)}function e(t,e){return e=e.shiftBlocks(n),t.write("<h2>").reference(e.get("title"),e,"h").write("</h2><ul>").section(e.get("songs"),e,{block:r},null).write('</ul><form method="post"><input type="text" name="id"><input type="submit"></form>')}function r(t,e){return e=e.shiftBlocks(n),t.write('<li><a href="/songs/').reference(e.get("$idx"),e,"h").write('">').reference(e.getPath(!0,[]),e,"h").write("</a></li>")}dust.register("songs",t);var n={main:e};return t}(),function(){var t=window.History;return t?(t.Adapter.bind(window,"statechange",function(){var e=t.getState(),r=e.data;$[r.method](r.action,r.data,function(t){t.data.skipLayout=!0,dust.render(t.template,t.data,function(e,r){document.body.innerHTML=r,document.title=t.data.title})})}),$(document).ready(function(){var e=function(e){e.preventDefault();var r=$(this),n={method:"get",action:"",data:""};r.is("a")&&(n.action=r.attr("href")),r.is("form")&&("post"===r.attr("method").toLowerCase()&&(n.method="post"),n.action=r.attr("action")||window.location.pathname,n.data=r.serialize()),t.pushState(n,"",n.action)};$("body").on("click","a",e),$("body").on("submit","form",e)}),void 0):!1}();